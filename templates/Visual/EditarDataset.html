{% extends "Visual/plantillaPadre.html" %}
{% load static %}
{% load poll_extras_rene_app %}

{% block titulo %}
Editar Dataset
{% endblock %}

{% block contenido %}

 <div class="row">

                    <div class="col">
                        <ul class="nav nav-tabs " id="myTab2" role="tablist">

                            <li class="nav-item" role="presentation">
                                <a class="nav-link active" id="descripcion-tab2" data-toggle="tab" href="#descripcion2"
                                    role="tab" aria-controls="descripcion2" aria-selected="false">Descripcion</a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link " id="clasificaciones-tab2" data-toggle="tab" href="#clasificaciones" role="tab"
                                    aria-controls="clasificaciones" aria-selected="true">Clasificaciones</a>
                            </li>

                            <li class="nav-item" role="presentation">
                                <a class="nav-link " id="home-tab2" data-toggle="tab" href="#home2" role="tab"
                                    aria-controls="home2" aria-selected="true">Detalles</a>
                            </li>

                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="profile-tab2" data-toggle="tab" href="#profile2" role="tab"
                                    aria-controls="profile2" aria-selected="false">Imagenes</a>
                            </li>

                        </ul>
                    </div>
                </div>



                <div class="row">
                    <div class="col">
                        <div class="tab-content " id="myTabContent2">

                            <div class="tab-pane fade show active" id="descripcion2" role="tabpanel" aria-labelledby="descripcion-tab2">
                               <div class="row mt-3">
                                        <div class="col-sm-6">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text" id="basic-addon1">Nombre</span>
                                                </div>
                                                <input id="idTextoNombreDataset" maxlength="50"
                                                       type="text" class="form-control"
                                                    placeholder="Nombre" aria-label="Nombre"
                                                    aria-describedby="basic-addon1">
                                                <div id="idTextoNombreDataset_MensajeInvalidoBoostrap"
                                                    class="invalid-feedback">
                                                    Please select a valid state.
                                                </div>
                                            </div>
                                        </div>

                                   <div class="col col-sm-6">

                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                  <label class="input-group-text" for="idSelectFrutos">Fruto</label>
                                                    <button id="idBuscarFruto" type="button" for="idSelectFrutos"
                                                    class="input-group-text btn btn-success">
                                                        <i class="fas fa-fas fa-search"></i>
                                                    </button>
                                                </div>
                                                <select class="custom-select" id="idSelectFrutos">
                                                  <option  selected>Agrega un Fruto</option>
{#                                                  <option value="1">One</option>#}
{#                                                  <option value="2">Two</option>#}
{#                                                  <option value="3">Three</option>#}
                                                </select>


                                                <div class="input-group-append">
                                                    <button id="idAgregarFruto" type="button" for="idSelectFrutos"
                                                    class="input-group-text btn btn-success">
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                    <button id="idEditarFruto" type="button" for="idSelectFrutos"
                                                    class="input-group-text btn btn-success">
                                                        <i class="fas fa-pencil-alt"></i>
                                                    </button>
                                                    <button id="idDetallesFruto" type="button" for="idSelectFrutos"
                                                    class="input-group-text btn btn-success">
                                                        <i class="fas fa-question"></i>
                                                    </button>

                                                  </div>
                                               <div id="idSelectFrutos_MensajeInvalidoBoostrap"
                                                        class="invalid-feedback ">
                                                        Seccione un dataset comprimido en formato rar
                                                    </div>
                                            </div>


                                        </div>


                                        {% comment %}<div class="col-sm-6">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text" id="basic-addon2">Tipo De
                                                        Fruto</span>
                                                </div>
                                                <input id="idTextoTipoDeFruto" type="text" class="form-control "
                                                    placeholder="Tipo De Fruto" aria-label="Tipo De Fruto"
                                                    aria-describedby="basic-addon2">
                                                <div id="idTextoTipoDeFruto_MensajeInvalidoBoostrap"
                                                    class="invalid-feedback">
                                                    otro mal.
                                                </div>
                                            </div>
                                        </div>{% endcomment %}

                                    </div>
                                    <div class="row mt-3">
                                        <div class="col">
                                            <!-- <textarea name="Descripcion" class=" ckeditor" id="id_Descripcion" rows="3" ></textarea> -->
                                            <textarea class=" ckeditor" name="editor1" id="editor1">
                                                {{ datosDataset.descripcion|conHTML }}
                                            </textarea>

                                            <div id="editor1_MensajeInvalidoBoostrap" class="invalid-feedback">
                                                otro mal.
                                            </div>
                                        </div>

                                    </div>





                            </div>

                            <div class="tab-pane fade  " id="clasificaciones" role="tabpanel" aria-labelledby="clasificaciones-tab2">

                                <div class="row mt-3 ">
                                        <div class="col">
                                            <div id="idContendorDeBordeDeListaclasificaciones"
                                            class="container border border-secondary">
                                                <div id="idAlerta_Listaclasificaciones" class="row alert alert-danger h-100 mb-0" role="alert"
                                                style="display: none;"
                                                >
                                                    A simple danger alert—check it out!
                                                  </div>
                                                <div class="row bg-dark text-light">
                                                    <div class="container">
                                                        <div class="row text-center mb-2 mt-2">
                                                            <div class="col-6">Clasificación</div>
                                                            <div class="col-6 border-left">Carpeta</div>
                                                        </div>
                                                    </div>

                                                </div>

                                                <div id="idContenedorDeLista" class="row overflow-auto"
                                                    style="max-height: 350px;">

                                                    <div id="idLista_2ColTextInput" class="list-group w-100">

                                                        <div id="{idItemLista}"
                                                            class="list-group-item list-group-item-action">
                                                            <div class="row">
                                                                <div class="col">
                                                                    <input id="{IdInputClasificacion}" maxlength="50"
                                                                        class="form-control " type="text"
                                                                        placeholder="Clasificación"
                                                                        value="{Clasificacion}">
                                                                    <div id="{IdInputClasificacion}_MensajeInvalidoBoostrap"
                                                                        class="invalid-feedback ">
                                                                        otro mal.
                                                                    </div>
                                                                </div>
                                                                <!-- border-left -->
                                                                <div class="col ">
                                                                    <input id="{IdInputCarpeta}" class="form-control "
                                                                        type="text" placeholder="Carpeta"
                                                                        value="{Carpeta}">
                                                                    <div id="{IdInputCarpeta}_MensajeInvalidoBoostrap"
                                                                        class="invalid-feedback">
                                                                        otro mal.
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>






                                                    </div>

                                                </div>
                                                <div class="row mt-2 mb-2 d-flex flex-row-reverse">
                                                    <button id="idB_ListaClases_Agregar"
                                                        class="btn btn-primary waves-effect waves-light ml-3 mr-3 "
                                                        type="button">
                                                        <span class="btn-label"><i class="fas fa-plus"></i></span>
                                                    </button>
                                                    <button id="idB_ListaClases_Eliminar"
                                                        class="btn btn-primary waves-effect waves-light ml-3"
                                                        type="button">
                                                        <span class="btn-label"><i class="fas fa-minus"></i></span>
                                                    </button>
                                                    <button id="idB_ListaClases_Arriba"
                                                        class="btn btn-primary waves-effect waves-light ml-3"
                                                        type="button">
                                                        <span class="btn-label"><i class="fas fa-angle-up"></i></span>
                                                    </button>
                                                    <button id="idB_ListaClases_Abajo"
                                                        class="btn btn-primary waves-effect waves-light ml-3"
                                                        type="button">
                                                        <span class="btn-label"><i class="fas fa-angle-down"></i></span>
                                                    </button>

                                                    <button id="idB_ListaClases_ReiniciarClases"
                                                        class="btn btn-primary waves-effect waves-light ml-3"
                                                        type="button">
                                                        <span class="btn-label"><i class="icon-refresh"></i></span>
                                                    </button>


                                                    <button id="idB_ListaClases_DetallesClase"
                                                        class="btn btn-primary waves-effect waves-light ml-3"
                                                            data-toggle="tooltip" data-placement="right" title="Editar descripción de la clasificación seleccionada "
                                                        type="button">
                                                        <span class="btn-label"><i class="fas fa-align-left"></i></span>
                                                    </button>

                                                </div>
                                            </div>



                                        </div>

                                    </div>

                            </div>
                            <div class="tab-pane fade  " id="home2" role="tabpanel" aria-labelledby="home-tab2">
                                <!-- border border-primary -->

                            <div class="row mt-3 h-50 ">
                                    <div class="col-sm-6 d-flex align-items-center">
                                        <div id="idContenendorDeParesdeDetalles" class="container">
                                            <div class="row mb-sm-2 mb-lg-4">
                                                <div class="col-6 d-flex justify-content-end  ">
                                                    <p class="h4"><strong>{NombreDato}:</strong></p>
                                                </div>
                                                <div class="col-6 d-flex justify-content-start">
                                                    <span>{Valor}</span>
                                                </div>
                                            </div>
                                        </div>

                                    </div>


                                    <div class="col-sm-6">

                                        <div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
                                            <ol id="idListaItemsDataset" class="carousel-indicators">
                                                <li data-target="#carouselExampleCaptions" data-slide-to="{iteracion}"
                                                    ></li>
                                                    <!-- class="active" active -->
                                            </ol>
                                            <div id="idContenidoDelCarrusel" class="carousel-inner">
                                                <div class="carousel-item ">

                                                    <div class="d-block  bg-secondary text-center"
                                                        style="display: none;"
                                                    >
                                                        <div id="{KEY_ID_SPINNER_CARRUSEL_}" class=" spinner-border text-primary "
                                                        style="width: 20rem; height: 20rem; display: none; " role="status">
                                                            <span class="sr-only">Loading...</span>
                                                        </div>
                                                    </div>


                                                    <img id="{KEY_ID_IMG_CARRUSEL_}" style="max-height: 400px;" src="img/900_600.jpg" class="d-block w-100" alt="...">
                                                    <div
                                                        class="carousel-caption d-none d-md-block fondoNegroTransparente">
                                                        <h5>{Clasificacion}</h5>
                                                        <p>{CantidadDeImagenes} imagenes</p>
                                                    </div>
                                                </div>



                                            </div>
                                            <a class="carousel-control-prev" href="#carouselExampleCaptions"
                                                role="button" data-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="sr-only">Previous</span>
                                            </a>
                                            <a class="carousel-control-next" href="#carouselExampleCaptions"
                                                role="button" data-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="sr-only">Next</span>
                                            </a>
                                        </div>

                                    </div>

                                </div>

                            </div>


                            <div class="tab-pane fade" id="profile2" role="tabpanel" aria-labelledby="profile-tab2">

                                <div class="row mt-2">

                                    <div class="col-12 col-lg-4">
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend">
                                                <label class="input-group-text"
                                                    for="idSelectImgProcesadas">Imagenes</label>
                                            </div>
                                            <select class="custom-select" id="idSelectImgProcesadas">
                                                <option value="Originales" selected>Originales</option>
                                                <option value="Procesadas">Procesadas</option>

                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-12 col-lg-4">
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend">
                                                <label class="input-group-text"
                                                    for="idSelectClasificacion">Clasificacion</label>
                                            </div>
                                            <select class="custom-select" id="idSelectClasificacion">
                                                <option value="{Clasificacion}" >{Clasificacion}</option>

                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-12 col-lg-4 d-flex justify-content-center d-lg-flex flex-lg-row-reverse">

                                        <nav id="idCargandoPaginacion"  style="display: none;"
                                        aria-label="Page navigation example">
                                            <ul  class="pagination ">
                                                <li  class="page-item disabled">
                                                    <a class="page-link" href="#" aria-label="Previous"
                                                    tabindex="-1" aria-disabled="true"
                                                    >
                                                        <span aria-hidden="true">&laquo;</span>
                                                    </a>
                                                </li>
                                                <li class="page-item">
                                                    <div class="spinner-border text-primary"  role="status">
                                                        <span class="sr-only">Loading...</span>
                                                      </div>
                                                </li>

                                                <li  class="page-item disabled">
                                                    <a class="page-link" href="#" aria-label="Next"
                                                    tabindex="-1" aria-disabled="true"
                                                    >
                                                        <span aria-hidden="true">&raquo;</span>
                                                    </a>
                                                </li>
                                            </ul>
                                        </nav>


                                        <nav id="idPaginacionImg" aria-label="Page navigation example">
                                            <ul id="idListaPaginacion" class="pagination ">
                                                <li id="idPaginacionAnterior" class="page-item">
                                                    <a class="page-link" href="#" aria-label="Previous">
                                                        <span aria-hidden="true">&laquo;</span>
                                                    </a>
                                                </li>
                                                <li id="idPaginacionNoSeleccionado" class="page-item"><a class="page-link" href="#">{KEY_INDICE}</a></li>
                                                <li id="idPaginacionSeleccionado" class="page-item active mouse_normal">
                                                    <a class="page-link mouse_normal" href="#">{KEY_INDICE}</a></li>
                                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                                <li id="idPaginacionSiguiente" class="page-item">
                                                    <a class="page-link" href="#" aria-label="Next">
                                                        <span aria-hidden="true">&raquo;</span>
                                                    </a>
                                                </li>
                                            </ul>
                                        </nav>
                                    </div>





                                </div>
                                <div class="row overflow-auto">
                                    <div class="col">
                                        <div class="container">
                                            <div class="row bg-dark text-light">
                                                <div class="container">
                                                    <div class="row text-center mb-2 mt-2">
                                                        <div class="col-1">#</div>
                                                        <div class="col-8 border-left">Nombre</div>
                                                        <div class="col-2 border-left">Opciones</div>
                                                    </div>

                                                    <div id="idCargandoTablaImagenes"
                                                    style="display: none;"
                                                     class=" row bg-light d-flex justify-content-center">
                                                                <div class="spinner-border text-primary" style="width: 10rem; height: 10rem;" role="status">
                                                                    <span class="sr-only">Loading...</span>
                                                                  </div>
                                                            </div>

                                                    <div id="idBodyTableImagenes" class="row overflow-auto"
                                                        style="max-height: 400px;">

                                                        <div class="list-group w-100 ">




                                                            <div id="{idItemLista}"
                                                                class="list-group-item list-group-item-action">
                                                                <div class="row">
                                                                    <div class="col-1 d-flex justify-content-center  ">{IndiceImagen}</div>
                                                                    <div class="col-8 ">{NombreImagen}</div>
                                                                    <div class="col-3 d-flex justify-content-center ">
                                                                        <button onclick="alApretarEnVerImagen('{IndiceImagen}')"
                                                                            type="button"
                                                                            class="btn  btn-dark boton_en_navegacion"
                                                                            data-toggle="tooltip" data-placement="top"
                                                                            title="Ver Imagen">
                                                                            <i class="  fas fa-eye"
                                                                                style="padding: 3px;"></i>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>



                                                        </div>
                                                    </div>

                                                </div>

                                            </div>
                                        </div>
                                    </div>


                                </div>



                            </div>

                        </div>
                    </div>
                </div>

    <div class="row mt-3">
                                    <div class="col d-flex justify-content-center">
                                        <button id="idBotonAgregar" type="button" class="btn btn-dark btn-lg">Editar</button>
                                    </div>
                                </div>


 <div id="idDlgEsperando" data-backdrop="static" class="modal fade" tabindex="-1" role="dialog"
                    style="display: none;" aria-hidden="true">
                    <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                            <div class="modal-body p-4">
                                <div class="text-center">
                                    <i class="dripicons-information h1 text-dark"></i>
                                    <h4 id="idTitulo_DlgEsperando" class="mt-2 text-dark">Aviso</h4>
                                    <p id="idContenido_DlgEsperando" class="mt-3 text-dark">Espere mientras ultimamos los detalles de la detención
                                        solicitada </p>


                                    <button type="button" class="btn btn-info my-2" data-dismiss="modal" disabled>
                                        <span class="spinner-border spinner-border-sm" role="status"
                                            aria-hidden="true"></span>
                                            <span id="idSpamEsperando_DlgEsperando">Deteniendo</span>

                                    </button>
                                </div>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div>

    <div id="idDlgImagenSelecciondada" class="modal fade" tabindex="-1" role="dialog"

                    aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Imagen</h5>
                                <button onclick="hideDlgBostrap('idDlgImagenSelecciondada')" type="button" class="close"  aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
{#                                data-dismiss="modal"#}
                              </div>

                            <div class="modal-body text-center">


                                <div id="idCargandoImagenDlg"
                                 class=" row  d-flex justify-content-center">
                                            <div class="spinner-border text-primary" style="width: 20rem; height: 20rem; display: none;" role="status">
                                                <span class="sr-only">Loading...</span>
                                              </div>
                                        </div>



                                <img id="idImgSeleccionada" src="..."  class="card-img-top " style="max-height: 450px;"  alt="...">

                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div>

    <div id="idDlgError2" data-backdrop="static" class="modal fade" tabindex="-1" role="dialog"
                    style="display: none;" aria-hidden="true">
                    <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                            <div class="modal-body p-4">
                                <div class="text-center">
                                    <i class="dripicons-information h1 text-dark"></i>
                                    <h4 id="idTitulo_idDlgError2" class="mt-2 text-dark">Aviso</h4>
                                    <p id="idContenido_DlgError2" class="mt-3 text-dark">Le informamos de la existencia
                                        de un error interno del servidor </p>


                                    <button id="idBotonAceptar_DlgError2"
                                            type="button" class="btn btn-info my-2" data-dismiss="modal">
                                        <!-- <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> -->
                                        Aceptar
                                    </button>
                                </div>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div>

    <div class="modal fade" id="idDlgDetalles"
                tabindex="-1" aria-labelledby="idClasificacion_idDlgDetalles" aria-hidden="true"
                data-backdrop="static"
                >
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable  modal-xl">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="idClasificacion_idDlgDetalles">Detalles de Clasificación</h5>

                        </div>
                        <div class="modal-body">
                            <textarea name="editor2" id="editor2">

                            </textarea>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                          <button id="idBAceptar_idDlgDetalles" type="button" class="btn btn-primary" data-dismiss="modal" >Aceptar</button>
                        </div>
                      </div>
                    </div>
                  </div>



     <div class="modal fade" id="idDlgSeleccionarFruto" tabindex="-1" role="dialog" aria-labelledby="scrollableModalTitle" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="scrollableModalTitle">Seleccione el Fruto</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">×</span>
                                </button>
                            </div>
                            <div class="modal-body" style="min-height: 300px;">
                                <div class="row justify-content-between">
                                    <div class="col-10">
                                        <form  >
                                            <!-- method="post" action="/{{urls.URL_VISTA_LISTA_CLASIFICACIONES_USUARIO}}/"
                                                    {% csrf_token %} -->
                                            <div class="input-group">
                                                <input name="{{nombre_text_filtro}}" id="idTextoFiltro" type="text" class="form-control"
                                                    aria-label="Text input with segmented dropdown button">
                                                <div class="input-group-append">
                                                    <button type="submit" class="btn btn-secondary "><i class="fas fa-search"></i></button>
                                                    <button type="button" class="btn btn-secondary  dropdown-toggle dropdown-toggle-split"
                                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                        <i class="fas fa-angle-down"></i>
                                                        <span class="sr-only">Toggle Dropdown</span>
                                                    </button>
                                                    <div class="dropdown-menu ">
                                                        <label class="btn btn-outline btn-info dropdown-item">
                                                            <div class="custom-control custom-radio">
                                                                <input type="checkbox" id="idCBFiltroNombre" name="tipoDeFiltro" value="idCBFiltroNombre"
                                                                    class="custom-control-input">
                                                                <label class="custom-control-label" for="idCBFiltroNombre">
                                                                    Nombre</label>
                                                            </div>
                                                        </label>

                                                        <label class="btn btn-outline btn-info dropdown-item">
                                                            <div class="custom-control custom-radio">
                                                                <input type="checkbox" id="idCBFiltroVariedad" name="tipoDeFiltro" value="idCBFiltroVariedad"
                                                                    class="custom-control-input">
                                                                <label class="custom-control-label" for="idCBFiltroVariedad">
                                                                    Variedad</label>
                                                            </div>
                                                        </label>
                                                        <label class="btn btn-outline btn-info dropdown-item">
                                                            <div class="custom-control custom-radio">
                                                                <input type="checkbox" id="idCBFiltroCientifico" name="tipoDeFiltro" value="idCBFiltroCientifico"
                                                                    class="custom-control-input">
                                                                <label class="custom-control-label" for="idCBFiltroCientifico">
                                                                    Nombre Científico</label>
                                                            </div>
                                                        </label>





                                                        <div role="separator" class="dropdown-divider"></div>
                                                        <label class="btn btn-outline btn-info dropdown-item">
                                                            <div class="custom-control custom-radio">
                                                                <input type="radio" id="idCBFiltroTodos" name="tipoDeFiltro" value="idCBFiltroTodos"
                                                                    class="custom-control-input" checked>
                                                                <label class="custom-control-label" for="idCBFiltroTodos">
                                                                    Todos</label>
                                                            </div>
                                                        </label>

                                                    </div>
                                                </div>
                                            </div>
                                            <input type="hidden" name="{{nombre_form_ubicacion_post}}" value="{{nombre_formulario_filtro}}">
                                        </form>
                                    </div>

                                    <div class="col-1 ">

                                        <div class="input-group d-flex justify-content-end">
                                            <div class="input-group-append ">
                                                <button id="idBDireccionDeOrden" type="button" class="btn btn-secondary ">

                                                    <i id="idIconoDireccionDeOrden" class="fas fa-search"></i></button>
                                                <!-- <button  type="button" class="btn btn-secondary "><i class="fas fa-search"></i></button> -->
                                                <button type="button" class="btn btn-secondary  dropdown-toggle dropdown-toggle-split"
                                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <i id="idIconoOrdenSeleccionado" class="fas fa-angle-down"></i>
                                                    <span class="sr-only">Toggle Dropdown</span>
                                                </button>
                                                <div class="dropdown-menu ">
                                                    <label class="btn btn-outline btn-info dropdown-item">
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="idCBOrdenarNombre" name="tipoDeOrden" value="idCBOrdenarNombre"
                                                                class="custom-control-input">
                                                            <label class="custom-control-label" for="idCBOrdenarNombre">
                                                                Nombre</label>
                                                        </div>
                                                    </label>

                                                    <label class="btn btn-outline btn-info dropdown-item">
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="idCBOrdenarVariedad" name="tipoDeOrden" value="idCBOrdenarVariedad"
                                                                class="custom-control-input">
                                                            <label class="custom-control-label" for="idCBOrdenarVariedad">
                                                                Variedad</label>
                                                        </div>
                                                    </label>
                                                    <label class="btn btn-outline btn-info dropdown-item">
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="idCBOrdenarCientifico" name="tipoDeOrden" value="idCBOrdenarCientifico"
                                                                class="custom-control-input">
                                                            <label class="custom-control-label" for="idCBOrdenarCientifico">
                                                                Nombre Científico</label>
                                                        </div>
                                                    </label>





                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- active onclick="setValueEnHiddenDataset('{id}')" -->
                                <ul id="idListaDeDataset" class="list-group  mt-3">
                                    <li  id="{idItem}" class="list-group-item   iten_navegacion_carpeta">
                                      <div class="row align-items-center">

                                          <div class="col-3 text-truncate">
                                            {NOMBRE_FRUTO}
                                          </div>
                                          <div class="col-3 text-truncate">
                                            {VARIEDAD_FRUTO}
                                          </div>
                                          <div class="col-3 text-truncate">
                                            {NOMBRE_CIENTIFICO_FRUTO}
                                        </div>
                                          <!-- <div class="col-5 text-truncate">
                                            <div class="row text-truncate font-weight-lighter text-muted subtexto_iten_navegacion">{VARIEDAD_FRUTO}</div>
                                             <div class="row text-truncate font-weight-lighter text-muted subtexto_iten_navegacion">{NOMBRE_CIENTIFICO_FRUTO}</div>

                                          </div> -->

                                          <div class="col-2 text-truncate">
                                            <div id="{idSpinner1_}" style="width: 80%; " class="card-img-top div_i">
                                                <div  class="spinner-border spinner-border-sm text-primary"  role="status">
                                                    <span class="sr-only">Loading...</span>
                                                  </div>
                                            </div>
                                            <img id="{idImg1_}" src="img/temp/50.jpg" style="width: 80%; display: none;"   alt="...">
                                            <!-- {NOMBRE_CIENTIFICO_FRUTO}
                                             <button type="button" class="btn  btn-dark boton_en_navegacion"
                                            data-toggle="tooltip" data-placement="top" title="Detalles"
                                            >
                                                <i class="far fa-question-circle"></i>
                                            </button>  -->
                                          </div>

                                      </div>




                                    </li>

                                  </ul>

                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-primary"  data-dismiss="modal">Cancelar</button>
                                <button id="idBotonSeleccionarDlgDataset" type="button" class="btn btn-dark" data-dismiss="modal">Seleccionar</button>


                            </div>
                            <!-- <input id="idHiddenDataset" type="hidden" name="{{nombre_form_ubicacion_post}}" value="{{form_loguin.nombre_form_loguin}}"/> -->
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div>


 <style>




                        #mycontainer {
                            width: 140px;
                            height: 450px;
                            border: 1px solid #ccc;
                        }
                    </style>

 <form id="idFormRecargarPaginaDatallesDataset"  method="get" action="/{{urls.URL_VISTA_CLASIFICAR_IMAGEN}}/">
        {% csrf_token %}
{#        <button type="submit" class="btn btn-primary btn-lg ml-4">Guardar</button>#}
{#        <input type="hidden" name="{{nombre_form_ubicacion_post}}" value="{{forms.GUARDAR_MODELO  }}">#}
    </form>
<form id="idFormIrAListarDataset"  method="get" action="/{{urls.URL_VISTA_LISTAR_DATASET}}/">
        {% csrf_token %}
{#        <button type="submit" class="btn btn-primary btn-lg ml-4">Guardar</button>#}
{#        <input type="hidden" name="{{nombre_form_ubicacion_post}}" value="{{forms.GUARDAR_MODELO  }}">#}
    </form>


{% endblock%}

{% block scripts_extras %}

    <!-- --> <div id="idReceptorDeHtml" style="display: none">
{{ datosDataset.descripcion|conHTML }}
    </div>

    <script src="{% static 'js/Librerias/date.format.js' %}"></script>
<script src="{% static 'js/Librerias/ckeditor/ckeditor.js' %}"></script>

    <script src="{% static 'js/reneJavaScritp/reneJS_UtilesDeLibrerias.js' %}"></script>

    <script src="{% static 'js/reneJavaScritp/reneJS_Componentes/reneJS_ListaSeleccionable.js' %}"></script>
    <script src="{% static 'js/controladores/rene_controlador_parte_clasificaciones_fijas_editables_dataset.js' %}"></script>
{#    <script src="{% static 'js/reneJavaScritp/reneJS_Componentes/reneJS_PaginacionVisual.js' %}"></script>#}
{#    <script src="{% static 'js/reneJavaScritp/reneJS_Boostrap/reneJS_Bootstrap_PaginacionVisual.js' %}"></script>#}
{#    <script src="{% static 'js/controladores/rene_controlador_detallesDataset.js' %}"></script>#}

    <script>



const ID_B_EDITAR_FRUTO="idEditarFruto";
const ID_B_DETALLES_FRUTO="idDetallesFruto";
const ID_SELECT_FRUTO="idSelectFrutos";

const mngSelcFruto=new ManagerContenidoSelecSimple();
mngSelcFruto.idSelect=ID_SELECT_FRUTO;

mngSelcFruto.listaParLabelValue=[
    {% for dato in listaDatosDeFrutos %}
        ["{{ dato.nombreCientifico }}","{{ dato.id }}"],
    {% endfor %}
];
mngSelcFruto.setAlActivar(id=>displayNone(id,false));
mngSelcFruto.setAlDesactivar(id=>displayNone(id,true));
mngSelcFruto.listaIdADesactivarSiEstaVacio=[ID_B_EDITAR_FRUTO,ID_B_DETALLES_FRUTO];
mngSelcFruto.aplicarConfiguracionVisual();




class DatosDelDataset{
    constructor(){
        this.id=null;
        this.nombre=null;
        this.descripcion=null;
        this.tipoDeFruto=null;
        this.nombreCientificoFruto=null;
        this.variedadFruto=null;
        this.usuario=null;
        this.creacion=null;
        this.cantidadDeImagenes=null;
        this.cantidadDeClasificaciones=null;
        this.listaPar_Clasificicacion_CantidadDeImagenes=[];
        this.lista_Clasificaciones=[];

    }
}

const mngDlgError2=new ManagerDlg_AceptarCancelar_Bootstrap("idDlgError2");
mngDlgError2.idContenido="idContenido_DlgError2";
mngDlgError2.idTitulo="idTitulo_idDlgError2";
mngDlgError2.setIdBotonAceptar("idBotonAceptar_DlgError2");

function showDlgError2(){
    mngDlgError2.showDlg("Advertencia "
    ,"Le informamos de la perdida de conexión con el servidor"
    ,"Aceptar",()=>{
        submit("idFormRecargarPaginaDatallesDataset");
        });
}

class MngDatosDeDataset{
    constructor(){
        this.bdDetalles=new BD_RowElement();
        this.bdDetalles.llaves=["NombreDato","Valor"];
        this.idContenendorDeParesdeDetalles="idContenendorDeParesdeDetalles";

        this.mngRepetidor=new ManagerRepetidor(this.idContenendorDeParesdeDetalles,this.bdDetalles);
    }
    actualizar(datosDelDataset){
        /*this.bdDetalles.addRow([
            "Nombre",datosDelDataset.nombre
        ]);
        this.bdDetalles.addRow([
            "Tipo De Fruto",datosDelDataset.tipoDeFruto
        ]); */
        this.bdDetalles.addRow([
            "Usuario",datosDelDataset.usuario
        ]);
        this.bdDetalles.addRow([
            "Creación",datosDelDataset.creacion
        ]);
        this.bdDetalles.addRow([
            "Imagenes",datosDelDataset.cantidadDeImagenes
        ]);
        this.bdDetalles.addRow([
            "Clasificaciones",datosDelDataset.cantidadDeClasificaciones
        ]);
        this.mngRepetidor.repetir();
        //repetidor(this.idContenendorDeParesdeDetalles,this.bdDetalles);
    }
}


//()

class MngCarrusel{
    constructor(){
        this.KEY_ID_IMG_CARRUSEL="KEY_ID_IMG_CARRUSEL_";
        this.KEY_ID_SPINNER_CARRUSEL="KEY_ID_SPINNER_CARRUSEL_";
        this.bdImagenesClasificaciones=new BD_RowElement();
        this.bdImagenesClasificaciones.llaves=["Clasificacion","CantidadDeImagenes"];
        this.bdImagenesClasificaciones.listaDeNombresIds=[this.KEY_ID_IMG_CARRUSEL,this.KEY_ID_SPINNER_CARRUSEL];

        this.idListaItemsDataset="idListaItemsDataset";
        this.idContenidoDelCarrusel="idContenidoDelCarrusel";

        this.urlAjaxGetImagen=null;

        this.mngRepetidor_itemsDataset=new ManagerRepetidor(this.idListaItemsDataset,this.bdImagenesClasificaciones);
        this.mngRepetidor_Carrusel=new ManagerRepetidor(this.idContenidoDelCarrusel,this.bdImagenesClasificaciones);

    }
    actualizar(listaPar_Clasificacion_CantidadDeImagenes){
        this.bdImagenesClasificaciones.clear();
        for (const row of listaPar_Clasificacion_CantidadDeImagenes) {
            this.bdImagenesClasificaciones.addRow(row);
        }
        this.mngRepetidor_itemsDataset.repetir();
        this.mngRepetidor_Carrusel.repetir();
        // repetidor(this.idListaItemsDataset,this.bdImagenesClasificaciones);
        // repetidor(this.idContenidoDelCarrusel,this.bdImagenesClasificaciones);

        let classActive="active";
        ponerClase(getFirsEl(this.idListaItemsDataset),classActive);
        ponerClase(getFirsEl(this.idContenidoDelCarrusel),classActive);


        for (let index = 0; index < this.bdImagenesClasificaciones.size(); index++) {
            let fila = this.bdImagenesClasificaciones.getFila(index);
            let map = fila.map;
            let mgImg64=new ManagerCargaLentaImgBase64();
            mgImg64.setIdElementoQueSustituyeLaImagen(map.get(this.KEY_ID_SPINNER_CARRUSEL));
            mgImg64.setIdImagen(map.get(this.KEY_ID_IMG_CARRUSEL));
            mgImg64.ocultarImagen();

            const indiceDeEstaImagen=index;
            ejecutarAjax("/"+this.urlAjaxGetImagen+"/",{
                    "idDataset":mngDts.datosDelDataset.id
                 ,"indiceDeImagen":indiceDeEstaImagen
                 },r=>{
                if(r.existeDataset){
                    mgImg64.cargarImgBase64(r.imgBase64);
                    //mgb.cargarImgBase64(r.imgBase64);

                }else{
                    console.log("no existe dataset");
                    //noMostrarImg()
                }

            }
            ,r=>{
                console.log("error al pedir la imagen del dataset");
                 //noMostrarImg()
                });

            //ajax
            //mgImg64.cargarImgBase64(str64);
        }

    }
}




class MngImagenes{
    constructor(){
        this.bd=new BD_RowElement();
        this.bd.llaves=["NombreImagen","IndiceImagen"];
        this.idCuerpoTablaImagenes="idBodyTableImagenes";
        this.pagV=new PaginacionVisual_Bootstrap();
        this.pagV.idListaPaginacion="idListaPaginacion";
        this.pagV.idNodoSeleccionadoPlantilla="idPaginacionSeleccionado";
        this.pagV.idNodoNoSeleccionadoPlantilla="idPaginacionNoSeleccionado";

        this.idSelectImgProcesadas="idSelectImgProcesadas";
        this.idSelectClasificacion="idSelectClasificacion";

        this.idCargandoPaginacion="idCargandoPaginacion";
        this.idPaginacionImg="idPaginacionImg";
        this.idCargandoTablaImagenes="idCargandoTablaImagenes";

        this.idCargandoImagenDlg="idCargandoImagenDlg";
        this.idImgSeleccionada="idImgSeleccionada";

        this.mgImg64=new ManagerCargaLentaImgBase64();
        this.mgImg64.setIdElementoQueSustituyeLaImagen(this.idCargandoImagenDlg);
        this.mgImg64.setIdImagen(this.idImgSeleccionada);

        this.idDlgImagenSeleccionada="idDlgImagenSelecciondada";
        this.bdClasificaciones=new BD_RowElement();
        this.bdClasificaciones.llaves=["Clasificacion"];

        this.urlAjaxMetodoGetListaDeImagenes=null;
        this.datosDelDataset=null;

        this.urlAjaxMetodoGetImagen=null;

        this.mngRepetidor_Clasificaciones=new ManagerRepetidor(this.idSelectClasificacion,this.bdClasificaciones);
        this.mngRepetidor_TablaImagenes=new ManagerRepetidor(this.idCuerpoTablaImagenes,this.bd);
    }
    actualizarClasificaciones(listaClasificaciones){
        this.bdClasificaciones.clear();
        for (const cla of listaClasificaciones) {
            this.bdClasificaciones.addRow([cla]);
        }
        //repetidor(this.idSelectClasificacion,this.bdClasificaciones);
        this.mngRepetidor_Clasificaciones.repetir();
        setAtr(getFirsEl(this.idSelectClasificacion),"selected","true")
    }
    mostrarImagenSeleccionada(str64){
        this.mgImg64.cargarImgBase64(str64);
        // showDlgBostrap(this.idDlgImagenSeleccionada);
    }
    estaSeleccionadaImagenesProcesadas(){
        return getValue(this.idSelectImgProcesadas)=="Procesadas";
    }
    __actualizarListaDeImagenes(idDelDataset,indiceDeLasImagenes
                                ,seEncuentraSeleccionadaImagenesProcesadas
    ,clasificacion){
        mngImg.ponerCargando()
        ejecutarAjax("/"+this.urlAjaxMetodoGetListaDeImagenes+"/",{
                    "idDelDataset":idDelDataset
                 ,"indiceDeLasImagenes":indiceDeLasImagenes
            ,"seEncuentraSeleccionadaImagenesProcesadas":seEncuentraSeleccionadaImagenesProcesadas
            ,"clasificacion":clasificacion
                 },r=>{
            console.log("r.existeDataset="+r.existeDataset);
                if(r.existeDataset){
                    let li=[];
                    console.log("r.primerIndiceDeImagen="+r.primerIndiceDeImagen);
                    console.log("r.dicDeImagenes="+r.dicDeImagenes);
                    console.log("r.listaDeIndices="+r.listaDeIndices);
                    let primerIndiceDeImagen=Number.parseInt(r.primerIndiceDeImagen);
                    for (let i = 0; i < r.cantidadDeImg; i++) {
                        li.push([r.dicDeImagenes[primerIndiceDeImagen+i],primerIndiceDeImagen+i]);
                    }
                    let p=new Paginacion(r.listaDeIndices,r.iActual);
                    mngImg.actualizar(p,li);
                    mngImg.quitarCargando();
                    //mgb.cargarImgBase64(r.imgBase64);

                }else{
                    showDlgError();
                }

            }
            ,r=>{
                 showDlgError();
                });
    }

    aplicarConfiguracion(){
        const self=this;
        this.pagV.addOnClickNoSeleccionado((id,indice)=>{
            let seEncuentraSeleccionadaImagenesProcesadas=self.estaSeleccionadaImagenesProcesadas();
            let clasificacion=getValue(self.idSelectClasificacion);
            self.__actualizarListaDeImagenes(
                self.datosDelDataset.id
                ,indice
                ,seEncuentraSeleccionadaImagenesProcesadas
                ,clasificacion

            );
            // console.log("id="+id);
            // console.log("indice="+indice);
            // console.log("seEncuntraSeleccionadaImagenesProcesadas="+seEncuntraSeleccionadaImagenesProcesadas);
            // console.log("clasificacion="+clasificacion);
        });
        addOnChange(self.idSelectClasificacion,v=>{
            let seEncuentraSeleccionadaImagenesProcesadas=self.estaSeleccionadaImagenesProcesadas();
            let clasificacion=getValue(self.idSelectClasificacion);

            //let indiceSeleccionado=self.pagV.paginacion.getIndiceSeleccionado();

            self.__actualizarListaDeImagenes(
                self.datosDelDataset.id
                ,1//indiceSeleccionado
                ,seEncuentraSeleccionadaImagenesProcesadas
                ,clasificacion

            );
            //---------------------------
            // console.log("------------------------------------");
            // console.log("indice="+indiceSeleccionado);
            // console.log("seEncuntraSeleccionadaImagenesProcesadas="+seEncuntraSeleccionadaImagenesProcesadas);
            // console.log("clasificacion="+clasificacion);
        });
        this.pagV.aplicarConfiguracion();
    }
    ponerCargando(){
        displayNone( this.idCargandoPaginacion,false);
        displayNone( this.idCargandoTablaImagenes,false);
        displayNone( this.idPaginacionImg,true);
        displayNone( this.idCuerpoTablaImagenes,true);
    }
    quitarCargando(){
        displayNone( this.idCargandoPaginacion,true);
        displayNone( this.idCargandoTablaImagenes,true);
        displayNone( this.idPaginacionImg,false);
        displayNone( this.idCuerpoTablaImagenes,false);
    }
    actualizar(paginacion,listaPar_Nombre_Indice){
        this.pagV.actualizar(paginacion);
        this.bd.clear();
        for (const row of listaPar_Nombre_Indice) {
            this.bd.addRow(row);
            // let NombreImagen=row[0];
            // let IndiceImagen=row[1];

        }
        //repetidor(this.idCuerpoTablaImagenes,this.bd);
        this.mngRepetidor_TablaImagenes.repetir();
        this.quitarCargando();
    }

}

const mngDts=new MngDatosDeDataset();
const mngCarr=new MngCarrusel();

const mngImg=new MngImagenes();
mngImg.aplicarConfiguracion();
function showDlgError(){
    mngDlgError.showDlg("Advertencia "
    ,"Le informamos de la perdida de conexión con el servidor"
    ,"Aceptar",()=>{
        submit("idFormRecargarPaginaDatallesDataset");
        });
}
function alApretarEnVerImagen(indiceDeLaImagen){
    let seEncuntraSeleccionadaImagenesProcesadas=mngImg.estaSeleccionadaImagenesProcesadas();
    let clasificacion=getValue(mngImg.idSelectClasificacion);
    //let indiceSeleccionado=mngImg.pagV.paginacion.getIndiceSeleccionado();

    let indiceDeLaImagenAMostrar=indiceDeLaImagen;
    mngImg.mgImg64.ocultarImagen();
    // console.log("mngImg="+mngImg);
    // console.log("mngImg.datosDelDataset="+mngImg.datosDelDataset);
    // console.log("mngImg.datosDelDataset.id="+mngImg.datosDelDataset.id);
    //console.log("this.urlAjaxMetodoGetListaDeImagenes="+mngImg.urlAjaxMetodoGetListaDeImagenes);
    //ajax
    ejecutarAjax("/"+mngImg.urlAjaxMetodoGetImagen+"/",{
                    "idDelDataset":mngImg.datosDelDataset.id
                 ,"indiceDeImagen":indiceDeLaImagenAMostrar
            ,"seEncuentraSeleccionadaImagenesProcesadas":seEncuntraSeleccionadaImagenesProcesadas
            ,"clasificacion":clasificacion
                 },r=>{
                if(r.existeDataset){
                    mngImg.mostrarImagenSeleccionada(r.imgBase64);
                }else{
                    showDlgError();
                }

            }
            ,r=>{
                showDlgError();
                });

    //mng.mostrarImagenSeleccionada(str);

    showDlgBostrap(mngImg.idDlgImagenSeleccionada);
}





function actualizarDatosDeImg(datosDeDatasetActual
                              ,urlAjaxGetImagenes
                              ,urlAjaxImagen900_600
                              ,urlAjaxMetodoGetImagen
){
mngImg.urlAjaxMetodoGetListaDeImagenes= urlAjaxGetImagenes;
mngImg.datosDelDataset=datosDeDatasetActual;
mngDts.datosDelDataset=datosDeDatasetActual;
mngCarr.urlAjaxGetImagen=urlAjaxImagen900_600;
mngImg.urlAjaxMetodoGetImagen=urlAjaxMetodoGetImagen;
mngDts.actualizar(datosDeDatasetActual);
mngCarr.actualizar(datosDeDatasetActual.listaPar_Clasificicacion_CantidadDeImagenes);
mngImg.actualizarClasificaciones(datosDeDatasetActual.lista_Clasificaciones);

//setHTML("idContenidoDescripcion",datosDeDatasetActual.descripcion);

}

    if(!{{ existeDataset|lower }}){
        showDlgError();

    }else{



            function vbdD(y,m,d){

                let va=new ValorBD(newDate(y,m,d));
                va.getStr=v=>{
                    //console.log("pasa por aqui v="+v);
                    let r=getStrFromDate(v,"mm/dd/yy hh:MM TT");
                    return r;
                };
                return va;
            }


            const dt=new DatosDelDataset();
            dt.id="{{ datosDataset.id }}";
            dt.nombre="{{ datosDataset.nombre }}";
            //dt.descripcion=getHTML("idReceptorDeHtml");
            //console.log("dt.descripcion="+dt.descripcion)
            dt.tipoDeFruto="{{ datosDataset.fruto }}";
            dt.nombreCientificoFruto="{{ datosDataset.variedadFruto }}";
            dt.variedadFruto="{{ datosDataset.nombreCientificoFruto }}";

            dt.usuario="{{ datosDataset.nombreUsuario }}";
            dt.creacion=vbdD({{ datosDataset.fechaDeCreacion.year }},{{ datosDataset.fechaDeCreacion.month }},{{ datosDataset.fechaDeCreacion.day }});
            dt.cantidadDeImagenes="{{  datosDataset.cantidadDeImagenes}}";
            dt.cantidadDeClasificaciones="{{datosDataset.cantidadDeClasificaciones}}";
            dt.listaPar_Clasificicacion_CantidadDeImagenes=[
                {% for clas in datosDataset.matris_Clasificacion_CantidadDeImagenes %}
                    ["{{ clas|getEn:0 }}",{{ clas|getEn:1 }} ],
                {% endfor %}
                {#["Madura",80]#}
                {#,["Verde",85]#}
                {#,["Pintona",34]#}
                {#,["Lista",40]#}
            ];
            dt.lista_Clasificaciones=[ {% for clas in datosDataset.clasificaciones %} "{{ clas }}",{% endfor %}];//["Madura","Verde","Pintona","Lista"];
            actualizarDatosDeImg(dt
                ,"{{ urls.URL_POST_METODO_GET_LISTA_IMAGENES_DEL_DATASET }}"
                ,"{{ urls.URL_POST_METODO_GET_IMG_DE_EJEMPLO_900_600_PX }}"
                ,"{{  urls.URL_POST_METODO_GET_IMG_DATASET_900_600_PX }}"
            );


            let li=[];
            //let dicImagenes={{ dicDeImagenes }};
            let dicImagenes=[{% for k in dicDeImagenes %} ["{{ dicDeImagenes|getEnDic:k }}",{{ k }}] ,{% endfor %}];
            let cantidadDeimagenes={{ cantidadDeImg }};
            let listaDeindices=[{% for indice in listaDeIndices %} {{ indice }} ,{% endfor %}];
            let iActual={{ iActual }};
            let primerIndiceDeImagen={{ primerIndiceDeImagen }};
            {#console.log("r.primerIndiceDeImagen="+primerIndiceDeImagen);#}
            {#console.log("r.dicDeImagenes="+dicImagenes);#}
            {#console.log("r.listaDeIndices="+listaDeindices);#}
           // let primerIndiceDeImagen=Number.parseInt(r.primerIndiceDeImagen);
            for (let i = 0; i < cantidadDeimagenes; i++) {
                //li.push([dicImagenes[primerIndiceDeImagen+i],primerIndiceDeImagen+i]);
                li.push(dicImagenes[i]);
            }
            let p=new Paginacion(listaDeindices,iActual);
            mngImg.actualizar(p,li);

    }



    //-------------------------------
const mngDlgEsperando=new ManagerDlg_Espera_ContenidoText_Bootstrap("idDlgEsperando");
mngDlgEsperando.idContenido="idContenido_DlgEsperando";
mngDlgEsperando.idTitulo="idTitulo_DlgEsperando";
mngDlgEsperando.idMensajeCargando="idSpamEsperando_DlgEsperando";

function showDlgComprobandoObjeto(){
    mngDlgEsperando.setMensajeCargando("Espere");
    mngDlgEsperando.showDlg("Comprobando "
    ,"Espere mientras se comprueban los datos del dataset solicitado ");
}
function showDlgFalloEnLaValidacion(mensaje){
    //estado.mostrandoMensajeDeErrorAceptar=true
    mngDlgError2.showDlg("Datos Inválidos "
    ,mensaje
    ,"Aceptar",()=>{
        //estado.mostrandoMensajeDeErrorAceptar=false

        });
}
const ID_INPUT_NOMBRE_DATASET="idTextoNombreDataset"
{#const ID_INPUT_TIPO_DE_FRUTO="idTextoTipoDeFruto"#}
const ID_INPUT_DESCRIPCION="editor1"

setValue(ID_INPUT_NOMBRE_DATASET,"{{ datosDataset.nombre }}");
{#setValue(ID_INPUT_TIPO_DE_FRUTO,"{{ datosDataset.fruto }}");#}

setValue(ID_SELECT_FRUTO,"{{ datosDataset.IdFruto }}");

const ID_B_AGREGAR_DATASET="idBotonAgregar";

    const MIN_CARACTERES=5;
const MAX_CARACTERES=50;
const V=new ValidacionConEventos_Boostrap();
V.addText_CON_ALFANUMERICOS(ID_INPUT_NOMBRE_DATASET).setMinCar(MIN_CARACTERES).setMaxCar(MAX_CARACTERES)
{#V.addText_CON_ALFANUMERICOS(ID_INPUT_TIPO_DE_FRUTO).setMinCar(MIN_CARACTERES).setMaxCar(MAX_CARACTERES)#}
V.addSelect_TipoValuePositivo(ID_SELECT_FRUTO,"Agrege algun fruto");

V.addBotonADesactivar(ID_B_AGREGAR_DATASET);
//V.comprovarValidacionYDesactivar();

    {#CKEDITOR.replace( ID_INPUT_DESCRIPCION );#}
    {#CKEDITOR.instances.editor1.setData(getHTML("idReceptorDeHtml"));#}





</script>


    <script>



const mngClases=new ManagerClasesClasificicacionesFijosEditables(V);
mngClases.idCkEditor2="editor2"
mngClases.idLista = "idLista_2ColTextInput";
mngClases.idB_Agregar_L = "idB_ListaClases_Agregar";
mngClases.idB_Eliminar_L = "idB_ListaClases_Eliminar";
mngClases.idB_Arriba_L = "idB_ListaClases_Arriba";
mngClases.idB_Abajo_L = "idB_ListaClases_Abajo";
mngClases.idContenedorDeLista_L = "idContenedorDeLista";
mngClases.idB_Detalles_L = "idB_ListaClases_DetallesClase";
mngClases.idTextAreaDlg_Detalles_L = "idClasificacion_idDlgDetalles";
mngClases.idBAceptar_idDlgDetalles_L = "idBAceptar_idDlgDetalles";
mngClases.idDlgDetalles_L = "idDlgDetalles";
mngClases.idAlertaClasificaciones_MSL = "idAlerta_Listaclasificaciones";
mngClases.idConendorDebordeDeListaClasificaciones_MSL = "idContendorDeBordeDeListaclasificaciones";
mngClases.idBotonReiniciarClases_MSL = "idB_ListaClases_ReiniciarClases";
mngClases.aplicarConfiguracion();


function prue(){
    mngClases.bd.mirarBD("Aquii:")
}



    </script>
<div style="display: none;" id="idReceptorDeHtmls">
{% for datos in datosDataset.matris_Clasificacion_Carpeta_Descripcion %}
    <div>{{ datos|getHtmlEn:2 }}</div>


        {% endfor %}
</div>
    <script>

    let m=[
        {% for datos in datosDataset.matris_Clasificacion_Carpeta_Descripcion %}
            ["{{ datos|getEn:0 }}","{{ datos|getEn:1 }}"],
        {% endfor %}
    ];
    let contenedoresDeHtml=getHijosEl("idReceptorDeHtmls");
    //console.log(contenedoresDeHtml);
    for (let i = 0; i <contenedoresDeHtml.length ; i++) {

        m[i].push(getHTML(contenedoresDeHtml[i]));
    }
    //console.log(m);
mngClases.actualizar(m);

    addOnClick(ID_B_AGREGAR_DATASET,v=>{
        showDlgComprobandoObjeto()

        mngClases.L.__actualizarBD();

        const matrisDeNombreDeClasificaciones=[]
        for (let i = 0; i < mngClases.bd.size(); i++) {
            let fila = mngClases.bd.getFila(i);
            let m=fila.map;
            let lista=[
                m.get(mngClases.KEY_CLASIFICACION)
                ,m.get(mngClases.KEY_CARPETA)
                ,m.get(mngClases.KEY_DETALLES)
            ];
            console.log(lista);
            matrisDeNombreDeClasificaciones.push(lista);
        }
        let listaDeCarpetas=[];
        let listaDeCalificaciones=[];
        let listaDeDetalles=[];
         for (let i = 0; i <matrisDeNombreDeClasificaciones.length ; i++) {
             listaDeCalificaciones.push(matrisDeNombreDeClasificaciones[i][0]);
            listaDeCarpetas.push(matrisDeNombreDeClasificaciones[i][1]);
            listaDeDetalles.push(matrisDeNombreDeClasificaciones[i][2]);
        }
         console.log(listaDeCarpetas);


        ejecutarAjax("/{{ urls.URL_POST_METODO_INTENTAR_EDITAR_DATASET }}/",
            {
                "{{form.id}}":"{{ datosDataset.id }}"
            ,"{{form.nombre}}":getValue(ID_INPUT_NOMBRE_DATASET)
            ,"{{form.tipoDeFruto}}":getValue(ID_SELECT_FRUTO)
            ,"{{form.descripcion}}":CKEDITOR.instances.editor1.getData()

                ,"listaDeCalificaciones":listaDeCalificaciones
            ,"listaDeCarpetas":listaDeCarpetas
                ,"listaDeDetalles":listaDeDetalles
            }
            ,r=>{//exito

                if(!r.fueValido){
                    mngDlgEsperando.hide()
                    showDlgFalloEnLaValidacion(r.mensaje);
                }else{
                    //alert('fue valido');
                    submit("idFormIrAListarDataset");
                }
            }
            ,r=>{ //error
                    mngDlgEsperando.hide()
                    showDlgError();
                    });
    });



function almacenarDatosEnLocalEstorage(){
     put("nombre",getValue(ID_INPUT_NOMBRE_DATASET));
    put("idFruto",getValue(ID_SELECT_FRUTO));
    put("descripcion",CKEDITOR.instances.editor1.getData());

     put("cantidad_de_clases",mngClases.bd.size());
    for (let i = 0; i < mngClases.bd.size(); i++) {
            let fila = mngClases.bd.getFila(i);
            let m=fila.map;
            put("indice_"+i+"_clasificaion",m.get(mngClases.KEY_CLASIFICACION));
            put("indice_"+i+"_nombreCarpeta",m.get(mngClases.KEY_CARPETA));
            put("indice_"+i+"_detalles",m.get(mngClases.KEY_DETALLES));

        }
    ejecutarAjax("/{{ urls.URL_POST_METODO_ALMACENAR_ID_DATASET_EDITAR }}/",
            {
                "idDataset":"{{ datosDataset.id }}"

            }
            ,r=>{//exito

                if(!r.fueValido){

                }else{

                }
            }
            ,r=>{
                    });
}

addOnClick("idAgregarFruto",v=>{
   almacenarDatosEnLocalEstorage();
    submit("idFormAgregarFruto");
});
addOnClick("idEditarFruto",v=>{
   almacenarDatosEnLocalEstorage();

   setValue("idHidenFrutoAEditar",getValue(ID_SELECT_FRUTO))
    submit("idFormEditarFruto");
});
addOnClick("idDetallesFruto",v=>{

   setValue("idHidenFrutoAVerDetalles",getValue(ID_SELECT_FRUTO))
    submit("idFormDetallesFruto");
});
//
if({{ hayQueRecuperarDatos|lower }}){
    setValue(ID_INPUT_NOMBRE_DATASET,get("nombre"));
    setValue(ID_SELECT_FRUTO,"{{ idUltimoFrutoAgregado }}");
    CKEDITOR.instances.editor1.setData(get("descripcion"));

     let m=[];


    let cantidadDeClases=inT(get("cantidad_de_clases"));
    for (let i = 0; i <cantidadDeClases ; i++) {
        m.push([
            get("indice_"+i+"_clasificaion")
            ,get("indice_"+i+"_nombreCarpeta")
            ,get("indice_"+i+"_detalles")
        ]);

    }

    V.comprovarValidacionYDesactivar()
    //console.log(m);
mngClases.actualizar(m);


}



const ID_FRUTO="ID_FRUTO";
const NOMBRE_FRUTO="NOMBRE_FRUTO";
const NOMBRE_CIENTIFICO_FRUTO="NOMBRE_CIENTIFICO_FRUTO";
const VARIEDAD_FRUTO="VARIEDAD_FRUTO";
const ID_ITEM="idItem";


const bdFrutos=new BD_RowElement();
bdFrutos.llaves=[ID_FRUTO,NOMBRE_FRUTO,VARIEDAD_FRUTO,NOMBRE_CIENTIFICO_FRUTO];
bdFrutos.listaDeNombresIds=[ID_ITEM];
{% for dato in listaDatosDeFrutos %}
     bdFrutos.addRow([
         "{{ dato.id }}"
         ,"{{ dato.nombre }}"
         ,"{{ dato.variedad }}"
         ,"{{ dato.nombreCientifico }}"
         ]);
{% endfor %}




function actualizarImagen(idImg,idDelSpiner,idFruto) {


            const mgb=new ManagerCargaLentaImgBase64();
            mgb.setIdElementoQueSustituyeLaImagen(idDelSpiner);
            mgb.setIdImagen(idImg);

            function noMostrarImg() {
                displayNone(idImg,true);
                displayNone(idDelSpiner,true);
            }


             ejecutarAjax("/{{ urls.URL_POST_METODO_GET_IMG_DE_EJEMPLO_50_PX_FRUTO }}/",{
                    "idDelFruto":idFruto

                 },r=>{
                if(r.existeFruto){
                    mgb.cargarImgBase64(r.imgBase64);

                }else{ noMostrarImg()}

            }
            ,r=>{
                 noMostrarImg()
                });
}

class MangerBuscarFruto{
    constructor(bd){
        this.bd=bd;

        this.dt=new FiltroText_CByTodos_v2(this.bd);

        this.listaKeysParafiltro=[];
        this.IdBaseElemtosAOcultar="idItem";
        this.IdCB_Todo="idCBFiltroTodos";
        this.IdsCb=[
            "idCBFiltroNombre"
            ,"idCBFiltroVariedad"
            ,"idCBFiltroCientifico"

        ];
        this.idText="idTextoFiltro";


        this.mngRep=new ManagerRepetidor("idListaDeDataset",this.bd);

        this.or=new OrdenadorRB_Visual_BD(this.bd);
        this.idBToggleOrdenamiento="idBDireccionDeOrden";
        this.matriz_IdsRByIcono=[
            ["idCBOrdenarNombre","fas fa-code-branch"]
            ,["idCBOrdenarVariedad","fas fa-bowling-ball"]
            ,["idCBOrdenarCientifico","fas fa-calendar-alt"]
            ];
        this.idIconoOrdenSeleccionado="idIconoOrdenSeleccionado";
        this.idIconoDireccionDeOrden="idIconoDireccionDeOrden";
        this.iconoOrdenAscendente="fas fa-angle-double-down";
        this.iconoOrdenDescendente="fas fa-angle-double-up";


        this.L=new ListaSeleccionable();
        this.idLista="idListaDeDataset";

        this.idBotonSeleccionarDlgFruto="idBotonSeleccionarDlgDataset";

        this.__metodoAlAceptarFruto=new ConjuntoDeEventos();

        this.KEY_ID_FRUTO="";
        this.KEY_ID_IMG_1="idImg1_";


        this.KEY_ID_SPINNER_1="idSpinner1_";

        this.bd.listaDeNombresIds.push(this.KEY_ID_IMG_1);
        this.bd.listaDeNombresIds.push(this.KEY_ID_SPINNER_1);

        this.__metodoActualizarImagenFruto=new ConjuntoDeEventos();

    }
    addActualizarImagenFruto(metodo){
        //metodo (idImg,idDelSpiner,idFruto)=>{}
        this.__metodoActualizarImagenFruto.add(metodo);
    }
    addAlAceptarFruto(metodo){
        //idFruto=>{}
        this.__metodoAlAceptarFruto.add(metodo);
    }
    aplicarConfiguracion(){
        const self=this;

        function actualizarImagenes() {
            for (let index = 0; index < self.bd.size(); index++) {
                let fila = self.bd.getFila(index);
                let mapActual = fila.map;
                let mIds=[
                    [self.KEY_ID_IMG_1,self.KEY_ID_SPINNER_1]

                ];
                let cantidaDeImagenes=1;//inT(mapActual.get(KEY_CANTIDAD_DE_CLASIFICACIONES));
               // console.log("cantidaDeImagenes="+cantidaDeImagenes);
                for (let j = 0; j < mIds.length; j++) {
                    const ids = mIds[j];
                    //console.log("j="+j+" "+ids);
                    const idImg=ids[0];
                    //console.log("idImg="+idImg);
                    const idDelSpiner=ids[1];

                    if(!(j<cantidaDeImagenes)){
                        displayNone(mapActual.get(idImg),true);
                        //displayNone(mapActual.get(idDelSpiner),true);
                        continue;
                    }
                    self.__metodoActualizarImagenFruto.ejecutar(mapActual.get(idImg),mapActual.get(idDelSpiner),mapActual.get(self.KEY_ID_FRUTO));

                }





            }
        }


        this.dt.llaves=this.listaKeysParafiltro;
        this.dt.setIdBaseElemtosAOcultar(this.IdBaseElemtosAOcultar);
        this.dt.IdCB_Todo=this.IdCB_Todo;
        this.dt.setIdsCb(this.IdsCb);
        this.dt.idText=this.idText;

        this.dt.addAlTerminarDeFiltrar(()=>{
            self.L.deseleccionarTodo();

        });
        this.dt.aplicarConfiguracionToggle();
        this.dt.setFiltroText();

        this.or.llaves=this.listaKeysParafiltro;
        this.or.accionDespuesDeOrdenar=()=>{
            self.L.actualizarVisual_APartirDeBD();
            self.dt.filtrar();
            actualizarImagenes();
        }
        this.or.idBToggleOrdenamiento=this.idBToggleOrdenamiento;
        this.or.setMapIdsRByIcono(new Map(this.matriz_IdsRByIcono));
        this.or.idIconoOrdenSeleccionado=this.idIconoOrdenSeleccionado;
        this.or.idIconoDireccionDeOrden=this.idIconoDireccionDeOrden;
        this.or.iconoOrdenAscendente=this.iconoOrdenAscendente;
        this.or.iconoOrdenDescendente=this.iconoOrdenDescendente;
        this.or.aplicarConfiguracionToggle();


        function desactivarBSeleccionarFruto(desactivar){
            setDisabled(desactivar,[self.idBotonSeleccionarDlgFruto]);
        }

        this.L.KEY_ID_ITEM_LISTA=this.IdBaseElemtosAOcultar;
        this.L.idLista=this.idLista;
        this.L.addAlSeleccionar(v=>{
            desactivarBSeleccionarFruto(false);
        });
        this.L.addAlDeseleccionar(v=>{
            desactivarBSeleccionarFruto(true);
        });
        this.L.mngRpLista=this.mngRep;
        this.L.bd=self.bd;
        this.L.aplicarConfiguracion();

        desactivarBSeleccionarFruto(true);
        addOnClick(this.idBotonSeleccionarDlgFruto,v=>{
            this.__metodoAlAceptarFruto.ejecutar(self.L.bd.getFila(self.L.indiceSeleccionado).map.get(self.KEY_ID_FRUTO));
        });

        this.or.aplicarConfiguracionVisual(0);

    }
}
const mngBFr=new MangerBuscarFruto(bdFrutos);
mngBFr.listaKeysParafiltro=[NOMBRE_FRUTO,VARIEDAD_FRUTO,NOMBRE_CIENTIFICO_FRUTO];
mngBFr.KEY_ID_FRUTO=ID_FRUTO;
mngBFr.addAlAceptarFruto(id=>{
    setValue(ID_SELECT_FRUTO,id);

})
mngBFr.addActualizarImagenFruto(actualizarImagen);
mngBFr.aplicarConfiguracion();
if(!bdFrutos.isEmpty()){
    addOnClick("idBuscarFruto",v=>{
        console.log("algo111111111111111")
        showDlgBostrap('idDlgSeleccionarFruto');
    });
}
    </script>
<script>

</script>
<form id="idFormAgregarFruto"  method="post" action="/{{urls.URL_VISTA_AGREGAR_FRUTO_DESDE_EXTERNO}}/">
        {% csrf_token %}
{#        <button type="submit" class="btn btn-primary btn-lg ml-4">Guardar</button>#}
        <input type="hidden" name="urlSalida" value="{{urls.URL_VISTA_EDITAR_DATASET}}">
    </form>
    <form id="idFormEditarFruto"  method="post" action="/{{urls.URL_VISTA_EDITAR_FRUTO_DESDE_EXTERNO}}/">
        {% csrf_token %}
{#        <button type="submit" class="btn btn-primary btn-lg ml-4">Guardar</button>#}
        <input id="idHidenFrutoAEditar" type="hidden" name="idDelFruto" value="-1">
        <input type="hidden" name="urlSalida" value="{{urls.URL_VISTA_EDITAR_DATASET}}">
    </form>

    <form id="idFormDetallesFruto"  method="post" action="/{{urls.URL_VISTA_DETALLES_FRUTO}}/">
        {% csrf_token %}
{#        <button type="submit" class="btn btn-primary btn-lg ml-4">Guardar</button>#}
        <input id="idHidenFrutoAVerDetalles" type="hidden" name="idDelFruto" value="-1">

    </form>

{% endblock%}